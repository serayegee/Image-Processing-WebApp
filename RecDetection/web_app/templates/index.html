<!DOCTYPE html>
<html>
<head>
    <title>Görsel Ölçüm</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f8fafc;
            color: #333;
        }
        .container {
            max-width: 950px;
            margin: auto;
            background: #fff;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            text-align: center;
        }
        h1, h2 {
            color: #005a87;
            margin-bottom: 15px;
        }
        form {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 25px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: #f9fafb;
        }
        input[type="file"], select, input[type="submit"] {
            padding: 10px;
            margin-top: 8px;
            border: 1px solid #ccc;
            border-radius: 6px;
            width: 100%;
            max-width: 300px;
            box-sizing: border-box;
            font-size: 14px;
        }
        input[type="submit"] {
            background-color: #007bff;
            color: white;
            cursor: pointer;
            border: none;
            font-weight: 500;
            transition: all 0.3s;
        }
        input[type="submit"]:hover {
            background-color: #0056b3;
            transform: translateY(-1px);
        }
        .image-preview-container {
            display: flex; 
            flex-wrap: wrap;
            justify-content: center; 
            align-items: center; 
            margin: 15px 0;
            gap: 12px;
        }
        .image-preview {
            max-width: 150px;
            height: auto;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            display: none;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        .images-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
        }
        .image-box {
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #fafafa;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .image-box img {
            max-width: 220px;
            height: auto;
            border-radius: 6px;
            margin-bottom: 8px;
        }
        .data {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 14px;
        }
        .data th, .data td {
            border: 1px solid #e5e7eb;
            padding: 8px;
            text-align: left;
        }
        .data th {
            background-color: #f3f4f6;
        }
        .data tr:nth-child(even) {
            background-color: #f9fafb;
        }
        .download-button {
            display: inline-block;
            margin-top: 5px;
            padding: 8px 16px;
            background-color: #28a745;
            color: white;
            font-size: 14px;
            font-weight: 500;
            text-decoration: none;
            border-radius: 6px;
            text-align: center;
            transition: all 0.3s;
        }
        .download-button:hover {
            background-color: #218838;
            transform: translateY(-1px);
        }
        .extra-options {
            margin-top: 12px;
            width: 100%;
            max-width: 300px;
            text-align: left;
            font-size: 14px;
        }
        .extra-options label, .extra-options input {
            display: block;
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1> Görsel Yükle ve İşle</h1>
        <form method="post" enctype="multipart/form-data">
            <label for="file"><b>Yeni Görsel Yükle:</b></label>
            <input type="file" name="file" id="file" multiple><br><br>

            <div class="image-preview-container" id="image-preview-container"></div>

            <label for="process_type"><b>İşlem Türü:</b></label>
            <select name="process_type" id="process_type">
                <option value="rotated_dikdortgen_olcum">Dikdörtgen Ölçüm</option>
                <option value="gray">Gri Tonlama</option>
                <option value="blur">Bulanıklaştırma (Gaussian)</option>
                <option value="median_blur">Bulanıklaştırma (Median)</option>
                <option value="edges">Kenar Tespiti (Canny)</option>
                <option value="binary">Eşikleme (Binary)</option>
                <option value="adaptive">Eşikleme (Adaptive)</option>
                <option value="otsu">Eşikleme (Otsu)</option>
                <option value="hist">Histogram</option>
                <option value="reset"> Sıfırla (Orijinal Görsele Dön)</option>
            </select>

            <div id="boyutlandirma_options">
                <div class="extra-options" id="referans_bilgisi">
                     Referans nesne boyutları: <b>50cm x 70cm</b>
                </div>
                <input type="checkbox" id="use_min_area" name="use_min_area" value="on">
                <label for="use_min_area">Minimum Alan Filtresi Uygula</label><br>
                <input type="checkbox" id="use_morph" name="use_morph" value="on">
                <label for="use_morph">Morfolojik Temizleme Uygula</label><br><br>
            </div>

            <input type="submit" value=" Yükle ve İşle">
        </form>

        {% if original_images %}
            <hr>
            <h2>Orijinal Görseller</h2>
            <div class="images-container">
                {% for filename in original_images %}
                <div class="image-box">
                    <img src="{{ url_for('static', filename='originals/' + filename) }}">
                </div>
                {% endfor %}
            </div>
        {% endif %}

        <div id="results-section" {% if not processed_images and not table_html %}style="display:none;"{% endif %}>
            {% if processed_images %}
                <hr>
                <h2>İşlenmiş Görseller</h2>
                <div class="images-container">
                    {% for filename in processed_images %}
                    <div class="image-box">
                        <img src="{{ url_for('static', filename='outputs/' + filename) }}">
                        <a href="{{ url_for('download_image', filename=filename) }}" class="download-button"> İndir</a>
                    </div>
                    {% endfor %}
                </div>
            {% endif %}

            {% if table_html %}
                <h2>Sonuçlar</h2>
                {{ table_html|safe }}
                <a href="{{ url_for('download_data') }}" class="download-button"> Verileri İndir (XLSX)</a>
            {% endif %}
        </div>
    </div>
    
    <script>
        const fileInput = document.getElementById('file');
        const imagePreviewContainer = document.getElementById('image-preview-container');
        const processTypeSelect = document.getElementById('process_type');
        const boyutlandirmaOptions = document.getElementById('boyutlandirma_options');
        const referansBilgisi = document.getElementById('referans_bilgisi');
        const resultsSection = document.getElementById('results-section');

        fileInput.addEventListener('change', function() {
            imagePreviewContainer.innerHTML = '';
            if (this.files && this.files.length > 0) {
                for (const file of this.files) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.className = 'image-preview';
                        img.style.display = 'block';
                        imagePreviewContainer.appendChild(img);
                    }
                    reader.readAsDataURL(file);
                }
            }
        });

        processTypeSelect.addEventListener('change', function() {
            const showOptions = ['rotated_dikdortgen_olcum'].includes(this.value);
            boyutlandirmaOptions.style.display = showOptions ? 'block' : 'none';
            referansBilgisi.style.display = showOptions ? 'block' : 'none';

            if (this.value === 'reset') {
                resultsSection.style.display = 'none';
            } else {
                resultsSection.style.display = 'block';
            }
        });

        window.onload = function() {
            const showOptions = ['rotated_dikdortgen_olcum'].includes(processTypeSelect.value);
            boyutlandirmaOptions.style.display = showOptions ? 'block' : 'none';
            referansBilgisi.style.display = showOptions ? 'block' : 'none';
        };
    </script>
</body>
</html>
